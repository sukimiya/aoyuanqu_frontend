<!--Reference from-->
<!--http://www.jq22.com/jquery-info13300-->
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta http-equiv="pragma" content="no-cache">
    <meta http-equiv="cache-control" content="no-cache">
    <meta http-equiv="expires" content="0">
    <title>税种核定</title>
    <link href="https://cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href="https://cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" type="text/css">
    <link href="https://cdn.bootcss.com/bootstrap-validator/0.5.3/css/bootstrapValidator.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.12.2/css/bootstrap-select.min.css">
    <link href="css/style.css" rel="stylesheet" type="text/css">
    <link href="css/my.css" rel="stylesheet" type="text/css">
    <script type="text/javascript" src="https://cdn.bootcss.com/jquery/3.2.1/jquery.js"></script>
    <script type="text/javascript" src="https://cdn.bootcss.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script src="https://cdn.bootcss.com/bootstrap-validator/0.5.3/js/bootstrapValidator.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.12.2/js/bootstrap-select.min.js"></script>
    <script src="http://res.wx.qq.com/open/js/jweixin-1.2.0.js"></script>
    <script type="text/javascript" src="js/jquery.flexText.min.js"></script>
    <script src="https://cdn.bootcss.com/json2/20160511/json2.min.js"></script>
    <script src="https://cdn.bootcss.com/moment.js/2.18.0/moment.min.js"></script>
    <script src="https://cdn.bootcss.com/moment.js/2.18.0/locale/zh-cn.js"></script>
    <script type="text/javascript" src="js/my.js"></script>
    <script type="text/javascript">
        var investorAry = [];
        var isAddMode = true;

        function formatDateTo(dstr) {
            var result = dstr;
            if (result.indexOf(" ") != -1) {
                var thedatearr = result.split(" ");
                var timearr = thedatearr[1].split(":");
                result = thedatearr[0] + " " + timearr[0] + ":" + timearr[1];
                return result;
            }
        }

        function initial(data) {
            debugger;
            if (data.confirm_name)
                $("#confirm_name").text(data.confirm_name);
            var today = new Date(formatDateTo(data.szhd_time));
            $("#appointment_time").val(today.Format("yyyy-MM-ddThh:mm"));
            if (data.hasOwnProperty("szhd_address")) {
                $("#szhd_address").val(data.szhd_address);
                if (data.szhd_address == distAddress.address4.name) {
                    $("#addressInfo").html('<a href="' + distAddress.address4.nav + '">' + distAddress.address4.address + '</a>');
                }
            }
            if (data.szhd_state1 == 2) {
                //已完成
                myweixin.initial();
                if (data.szhd_license == null || data.szhd_license) {
                    $("#photoGroup").removeClass("hide");
                    getRemotePic(data.szhd_license, $("#szhd_license_img"));
                }
                $("#submitbtn").addClass("hide");
                $("#appointment_time").attr("disabled", "yes");
                $("#szhd_address").attr("disabled", "yes");
            } else {
                //未完成
                if (data.szhd_state == 2) {
                    //已经提交
                    $("#submitbtn").addClass("hide");

                } else {
                    //未提交
                    myweixin.initial();
                    $("#appointment_time").attr('min', today.Format("yyyy-MM-ddThh:mm"));
                    var month = new Date(new Date().setMonth(today.getMonth() + 6));
                    $("#appointment_time").attr('max', month.Format("yyyy-MM-ddThh:mm"));
                    $("#submitbtn").on("click", function(events) {
                        var params = "id=" + GetRequest()["id"] + "&szhd_time=" + $("#appointment_time").val().replace("/", "-") + "&szhd_address=" + $("#szhd_address").val() + "&szhd_state=2";
                        myapi.request("updateStartSZHD", null, params, function(result) {
                            window.location = "ee_progress.html?id=" + GetRequest()["id"];
                        }, function() {});
                    });
                }
            }
            checkInputFileImg();
            var myvalidator = $('#bookform').bootstrapValidator({
                feedbackIcons: {
                    valid: 'glyphicon glyphicon-ok',
                    invalid: 'glyphicon glyphicon-remove',
                    validating: 'glyphicon glyphicon-refresh'
                },
                fields: {
                    appointment_time: {
                        validators: {
                            message: '请正确填写预约时间',
                            notEmpty: {
                                message: '预约时间不能为空',
                            }
                        }
                    },
                    szhd_address: {
                        validators: {
                            message: '请选择预约地点',
                            notEmpty: {
                                message: '预约地点不能为空',
                            }
                        }
                    },
                    express_address: {
                        validators: {
                            message: '请正确填写收件地址',
                            notEmpty: {
                                message: '收件地址不能为空',
                            }
                        }
                    }
                }
            });
            myvalidator.on('success.form.bv', function(e) {
                $("#submitbtn").on("click", function(events) {
                    var params = "id=" + GetRequest()["id"] + "&szhd_time=" + $("#appointment_time").val().replace("/", "-") + "&szhd_address=" + $("#szhd_address").val() + "&szhd_state=2";
                    myapi.request("updateStartSZHD", null, params, function(result) {
                        window.location = "ee_progress.html?id=" + GetRequest()["id"];
                    }, function() {});
                });
            });
        }
        var myapi = restapis;
        $(document).ready(function() {
            myapi.request("searchSZHD", null, "id=" + GetRequest()["id"], function(result) {
                initial(result);
            }, function(e) {});
            createAppointmentAddress("#szhd_address", "#addressInfo", distAddress.address3, distAddress.address4);
        })

        function onpreview() {
            previewImagebyWX($("#szhd_license_img").attr("src"));
        }

    </script>
</head>

<body class="my-body">

    <div style="padding:0px;marging:0px;background-size: cover;overflow-y:visible;">
        <img class="col-xs-4 col-xs-offset-4 img-responsive my-gap-top" src="images/dfa8c6ef0acedc844c59669f4f24fe1a.png">
        <div class="section my-topsection">
            <div class="container" style="vertical-align:mid;">
                <div class="col-xs-12 text-center my-gap-bottom">
                    <!--h3> 企业名称预先核准申请书</h3-->
                </div>
            </div>
            <div class="container">
                <div class="form-group">
                    <label class="clearfix">登记企业名称</label>
                    <label id="confirm_name" class="my-form-label text-center clearfix">&nbsp;
                    </label>
                </div>
                <form id="bookform">
                    <div class="form-group">
                        <label class="clearfix">面签预约时间</label>
                        <div class="form-group">
                            <input id="appointment_time" class="form-control" type="datetime-local">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="clearfix">面签预约地点</label>
                        <select id="szhd_address" name="szhd_address" class="mycompany-select">
                        </select>
                        <div id="addressInfo" class="well">&nbsp;
                        </div>
                    </div>
                    <div id="photoGroup" class="text-center hide">
                        <hr>
                        <a href="javascript:onpreview()"><img id="szhd_license_img" class="img-responsive my-gap-top my-gat-bottom" src="images/picframe.svg"></a>

                    </div>
                    <div class="row important-notify text-center">
                        <h3>重要提示</h3>
                        <div class="clearfix">
                            <ul>
                                <li>到场人员：企业法人及财务。</li>
                                <li>携带材料：《营业执照》正本、《银行开户许可证》、经营场所《房产证》复印件及《房屋合同》原件、《房屋租赁的发票》、《法人及财务身份证》原件、《会计上岗证》、企业公章、发票专用章、数字证书。</li>
                                <li>如有任何问题，请致电岗位服务电话：021-57320084。</li>
                            </ul>
                        </div>
                    </div>
                    <button id="submitbtn" class="btn btn-primary col-xs-12 my-gap-top">提交</button>
                </form>
            </div>
        </div>
    </div>

</body>

</html>
