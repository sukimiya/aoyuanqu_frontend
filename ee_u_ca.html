<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="pragma" content="no-cache">
    <meta http-equiv="cache-control" content="no-cache">
    <meta http-equiv="expires" content="0">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta http-equiv="pragma" content="no-cache">
    <meta http-equiv="cache-control" content="no-cache">
    <meta http-equiv="expires" content="0">
    <title>执照发放</title>
    <link href="https://cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href="https://cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" type="text/css">
    <link href="https://cdn.bootcss.com/bootstrap-validator/0.5.3/css/bootstrapValidator.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.12.2/css/bootstrap-select.min.css">
    <link href="css/style.css" rel="stylesheet" type="text/css">
    <link href="css/my.css" rel="stylesheet" type="text/css">
    <style type="text/css">
        .my-form-h1 {}

        .my-form-label {
            font-size: 16px;
            font-weight: bold;
            color: #e51c23;
        }

    </style>
    <script type="text/javascript" src="https://cdn.bootcss.com/jquery/3.2.1/jquery.js"></script>
    <script type="text/javascript" src="https://cdn.bootcss.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script src="https://cdn.bootcss.com/bootstrap-validator/0.5.3/js/bootstrapValidator.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.12.2/js/bootstrap-select.min.js"></script>
    <script type="text/javascript" src="js/jquery.flexText.min.js"></script>
    <script src="https://cdn.bootcss.com/json2/20160511/json2.min.js"></script>
    <script src="http://res.wx.qq.com/open/js/jweixin-1.2.0.js"></script>
    <script type="text/javascript" src="js/my.js"></script>
    <script type="text/javascript">
        var isunfinishList = true;
        var mywx = myweixin;

        function toLoadList(isfinish) {
            var ltype = 0;
            if (!isfinish) {
                ltype = 1;
                $("#expressGroup").removeClass("hide");
            } else {
                $("#expressGroup").addClass("hide");
            }
            if (dropload) me = dropload;
            doloadlist($("#searchbarTf").val(), 1, ltype, false, me);
        }

        function getShippers() {
            $.ajax({
                url: "json/expressinfo.json",
                dataTyle: "json",
                type: "GET",
                cache: false,
                success: function(data) {
                    var jobj = data;
                    for (var i = 0; i < jobj.lists.length; i++) {
                        var node = jobj.lists[i];
                        var nodestr = "<option value='" + node["ShipperCode"] + "'>" + node["Shipper"] + "</option>";
                        $("#shipper").append(nodestr);
                    }
                    $("#shipper").selectpicker('refresh');
                }
            });
        }
        //
        var curlicense_state = 0;
        var hasexpress = false;
        $(document).ready(function() {
            checkInputFileImg();
            var myapi = restapis;
            $('textarea').flexText();
            getShippers();

            myapi.request("searchZZFF", null, "id=" + GetRequest()["id"], function(data) {
                debugger;
                var getobj = data;
                $("#company_name").text(getobj["confirm_name"]);
                if (getobj.license_state == 1) {
                    if (getobj.hasOwnProperty("license_pic")) {

                        $("#imgcon").addClass("hide");
                        $("#lisence_pic1").val(getobj["license_pic"]);
                        debugger;
                        if (getobj.license_takekind == 1) {
                            $("#receive_name").val(getobj.receive_name);
                            $("#receive_phone").val(getobj.receive_phone);
                            $("#express_address").val(getobj.express_address);
                            $("#my-state-1").removeClass("hide");
                        }else{
                            $("#my-state-1").addClass("hide");
                        }
                        getRemotePic(getobj.license_pic, $("#lisenceImg"));
                        $("#submitBtn").text("审核");
                        $("#submitBtn").on("click", function() {
                            var requestStr = "id=" + GetRequest()["id"];
                            if (getobj.license_takekind == 1) {
                                requestStr += "&express_number=" + $("#express_code").val();
                                requestStr += "&express_company=" + $("#shipper").val();
                            }
                            requestStr += "&license_pic=" + $("#lisence_pic1").val();
                            requestStr += "&license_state=2";
                            myapi.request("updateLicense", null, requestStr, function(data) {
                                    debugger;
                                    console.log("deliver infomation had been record.");
                                    window.location = "ee_u_progress.html";
                                },
                                function(e) {});
                        });
                    } else {
                        $("#my-state-1").addClass("hide");
                        $("#submitBtn").on("click", function() {
                            var requestStr = "id=" + GetRequest()["id"];
                            requestStr += "&license_pic=" + $("#lisence_pic1").val();
                            requestStr += "&license_state=1";
                            myapi.request("updateLicense", null, requestStr, function(data) {
                                    debugger;
                                    console.log("deliver infomation had been record.");
                                    window.location = "ee_u_progress.html";
                                },
                                function(e) {});
                        });
                    }
                } else if (getobj.license_state == 2) {
                    $("#my-state-1").addClass("hide");
                    $("#submitBtn").addClass("hide");
                    $("#imgcon").addClass("hide");
                    $("#lisence_pic1").val(getobj["license_pic"]);
                    getRemotePic(getobj.license_pic, $("#lisenceImg"));
                    $("#expressInfoGroup").append('<div class="well well-lg">快递公司:'+getobj["express_company"]+'<p>'+getobj["express_number"]+'</p></div>')
                } else {
                    $("#my-state-1").removeClass("hide");
                    $("#receive_name").text(getobj["receive_name"]);
                    $("#receive_phone").text(getobj["receive_phone"]);
                    $("#express_address").text(getobj["express_address"]);
                    $("#lisence_pic1").val(getobj["license_pic"]);
                    $("#my-state-1").removeClass("hide");
                    $("#imgcon").addClass("hide");
                    getRemotePic(getobj.license_pic, $("#lisenceImg"));
                }
            }, function(e) {});
            $("#file").on("change", function() {
                UploadCompressedImage($("#file"), "#lisence_pic1", function(result) {
                    $("#uploadlabel").text("上传完毕");
                    $("#lisence_pic1").val(result.fileName);
                    getRemotePic(result.fileName, $("#lisenceImg"));
                }, function(event) {
                    alert("上传失败");
                });
            });
            mywx.initial();
        });

        function topreivew(theid) {
            var imgid = $(theid).attr("src");
            previewImagebyWX(imgid);
        }

    </script>
</head>

<body class="my-body">
    <img class="col-xs-4 col-xs-offset-4 img-responsive my-gap-top" src="images/dfa8c6ef0acedc844c59669f4f24fe1a.png">
    <div class="section my-topsection">
        <div class="container" style="vertical-align:mid;">
            <div class="col-xs-12 text-center my-gap-bottom">
                <!--h3> 企业名称预先核准申请书</h3-->
                <h1>&nbsp;</h1>
                <a href="javascript:topreivew('#lisenceImg')">
                    <img id="lisenceImg" class="img-responsive my-gap-top" src="images/picframe.svg">
                </a>
                
                <a id="imgcon" href="javascript:;" class="a-upload btn btn-success col-xs-6 col-xs-offset-3 my-gap-top">
                    <img class="img-responsive">
                    <canvas></canvas>
                    <input class="my-caver-upload" type="file" capture="camera" accept="image/*" name="file" id="file">
                    <label id="uploadlabel" class="my-upload-label">拍照上传</label>
                </a>
                
            </div>
        </div>
        <div class="container">
            <h3 id="company_name" class="well">&nbsp;</h3>
        </div>
        <div id="expressInfoGroup"></div>
    </div>
    <div class="section">
        <div class="container">
            <hr>
            <div id="my-state-1">
                <input id="lisence_pic1" type="hidden">
                <div class="form-group">
                    <label>收件人:</label>
                    <input type="text" class="form-control" id="receive_name" disabled>
                </div>
                <div class="form-group">
                    <label>联系电话:</label>
                    <input type="tel" class="form-control" id="receive_phone" disabled>
                </div>
                <div class="form-group">
                    <label>快递地址:</label>
                    <input type="text" class="form-control" id="express_address" disabled>
                </div>
                <hr>
                <div class="form-group">
                    <label>选择快递公司</label>
                    <select id="shipper" name="shipper" class="mycompany-select">
                        </select>
                </div>
                <div class="form-group">
                    <label>快递单号:</label>
                    <input class="form-control" id="express_code" required/>
                </div>
            </div>
            <a id="submitBtn" class="btn btn-primary col-xs-12">提交</a> &nbsp;
        </div>
        
    </div>
</body>

</html>
